---
// NO prerender = SSR por defecto ‚úÖ Para l√≥gica de booking

import Layout from '../layouts/Layout.astro';
import { getCurrentHotel } from '../lib/directus.js';

console.log(`üîÑ [SSR] Processing booking request...`);

// Get hotel data from environment variable
const hotel: any = await getCurrentHotel();

if (!hotel) {
  throw new Error('Hotel not found. Check HOTEL_ID in environment variables.');
}

console.log(`‚úÖ [SSR] Hotel loaded: ${hotel.name} (ID: ${hotel.id})`);

const pageTitle = `Book Your Stay - ${hotel.name}`;
const pageDescription = `Book your perfect stay at ${hotel.name}. Check availability, compare rooms, and make your reservation instantly.`;

// Get URL parameters for pre-filling the form
const url = new URL(Astro.request.url);
const checkIn = url.searchParams.get('checkin') || '';
const checkOut = url.searchParams.get('checkout') || '';
const adults = url.searchParams.get('adults') || '2';
const children = url.searchParams.get('children') || '0';
const rooms = url.searchParams.get('rooms') || '1';
const roomType = url.searchParams.get('roomType') || '';

console.log(`üîÑ [SSR] Booking parameters:`, { checkIn, checkOut, adults, children, rooms, roomType });

// Future: Here we'll add availability checking logic
// const availableRooms = checkIn && checkOut 
//   ? await getAvailableRooms(hotel.id, checkIn, checkOut, guests)
//   : [];
---

<Layout title={pageTitle} description={pageDescription} hotel={hotel} hotelName={hotel.name}>
  <main class="bg-base-200 min-h-screen">
    <!-- Hero Section -->
    <section class="relative bg-gradient-to-r from-primary/20 to-secondary/20 py-16">
      <div class="mx-auto px-4 container">
        <div class="text-center">
          <h1 class="mb-4 text-primary/90 text-4xl md:text-6xl">
            Book Your Stay
          </h1>
          <p class="opacity-80 mb-8 text-xl md:text-2xl">
            at {hotel.name}
          </p>
          <div class="mx-auto max-w-2xl">
            <p class="opacity-70 text-lg">
              Experience luxury and comfort with our seamless booking system.
              Check real-time availability and secure your perfect room today.
            </p>
          </div>
        </div>
      </div>
    </section>

    <!-- Booking Form Section -->
    <section class="py-16">
      <div class="mx-auto px-4 container">
        <div class="mx-auto max-w-4xl">
          <!-- Search Form -->
          <div class="bg-base-100 shadow-lg mb-8 p-8 rounded-lg">
            <h2 class="mb-6 text-base-content/80 text-2xl">Check Availability</h2>
            <form class="gap-4 grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5">
              <!-- Check-in Date -->
              <div class="form-control">
                <label class="label">
                  <span class="text-base-content/80 label-text">Check-in</span>
                </label>
                <input 
                  type="date" 
                  name="checkin"
                  value={checkIn}
                  class="input-bordered w-full input" 
                  required
                />
              </div>

              <!-- Check-out Date -->
              <div class="form-control">
                <label class="label">
                  <span class="label-text text-base-content/80">Check-out</span>
                </label>
                <input 
                  type="date" 
                  name="checkout"
                  value={checkOut}
                  class="input-bordered w-full input" 
                  required
                />
              </div>

              <!-- Adults -->
              <div class="form-control">
                <label class="label">
                  <span class="label-text text-base-content/80">Adults</span>
                </label>
                <select name="adults" class="w-full select-bordered select">
                  <option value="1" selected={adults === '1'}>1 Adult</option>
                  <option value="2" selected={adults === '2'}>2 Adults</option>
                  <option value="3" selected={adults === '3'}>3 Adults</option>
                  <option value="4" selected={adults === '4'}>4 Adults</option>
                </select>
              </div>

              <!-- Children -->
              <div class="form-control">
                <label class="label">
                  <span class="label-text text-base-content/80">Children</span>
                </label>
                <select name="children" class="w-full select-bordered select">
                  <option value="0" selected={children === '0'}>0 Children</option>
                  <option value="1" selected={children === '1'}>1 Child</option>
                  <option value="2" selected={children === '2'}>2 Children</option>
                  <option value="3" selected={children === '3'}>3 Children</option>
                </select>
              </div>

              <!-- Search Button -->
              <div class="form-control">
                <label class="label">
                  <span class="label-text">&nbsp;</span>
                </label>
                <button type="submit" class="w-full btn btn-primary">
                  Search Rooms
                </button>
              </div>
            </form>
          </div>

          <!-- Available Rooms Section -->
          <div class="bg-base-100 shadow-lg p-8 rounded-lg">
            <h2 class="mb-6 text-base-content/80 text-2xl">Available Rooms</h2>
            
            {/* Future: Display available rooms here */}
            <div class="py-12 text-center">
              <div class="mb-4 text-6xl">üè®</div>
              <h3 class="mb-2 text-base-content/80 text-xl">Booking Engine Coming Soon</h3>
              <p class="mb-6 text-base-content/70">
                Our advanced booking system is being integrated. 
                For now, please contact us directly to make a reservation.
              </p>
              <div class="flex sm:flex-row flex-col justify-center gap-4">
                <a href="/contact" class="btn btn-primary">Contact Us</a>
                <a href="tel:+1234567890" class="btn-outline btn">Call Now</a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </section>
  </main>
</Layout>
