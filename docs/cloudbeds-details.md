# Cloudbeds API v1.3 Integration Details

This document provides details on integrating with the Cloudbeds API v1.3, including a recommended implementation flow for a booking engine and detailed endpoint reference.

## Recommended Booking Flow (Frontend + Backend)

Based on the Cloudbeds API v1.3 for a single property (`propertyID`). The same flow applies to multiple properties.

| Step | UI Goal | Cloudbeds Endpoint | Key Parameters | Implementation Notes |
| :--- | :--- | :--- | :--- | :--- |
| 1 | **Search** – Guest enters dates, # of rooms, occupancy | **`getAvailableRoomTypes`** | `propertyIDs`, `startDate`, `endDate`, `rooms`, `adults`, `children`, `promoCode?`, `detailedRates?` | Returns availability, base rates, and photos for each room type in a single call. Use this to populate the initial grid/list of results. |
| 2 | **Results List** – Show available room types, "from" price, photos | (Same response as above) | — | Save the `roomTypeID` and `roomRateID` the guest might select. Don't call `getRate` yet to save latency. |
| 3 | **Room Details / Rate Selection** | **`getRatePlans`** *or* **`getRate`** | - If you offer *multiple* rates (refundable, non-ref, package, etc.): `getRatePlans` with `roomTypeID`, dates, and occupancy.<br>- If you only need to check 1 specific rate (e.g., the public one): `getRate` with `roomTypeID`, dates, and occupancy. | - Use `detailedRates=true` if you want a night-by-night price breakdown.<br>- Display policies and LOS restrictions (`minLos`, `maxLos`, `closedToArrival/Departure`). |
| 4 | **Extras & Upsells** – Final occupancy, promo codes | Re-call **`getRate`** or **`getRatePlans`** with changes | `adults`, `children`, `promoCode` | You get the adjusted `totalRate` and, if applicable, `adultsExtraCharge`/`childrenExtraCharge` surcharges. |
| 5 | **Tax & Fee Calculation at Checkout** | **`getRoomsFeesAndTaxes`** | `propertyID`, `startDate`, `endDate`, `roomsTotal` (sum of `totalRate`s), `roomsCount` | The API returns `fees`, `taxes`, and `grandTotal`. Ideal for the "Review and Pay" step. |
| 6 | **Payment Screen** – Choose payment method | **`getPaymentMethods`** (optional: `getPaymentsCapabilities`) | `propertyID`, `lang` | Show only active methods (e.g., virtual POS, Stripe, cash at reception). If using Cloudbeds Payments, check capabilities (terminal, Tap‑to‑Pay, Pay‑by‑Link). |
| 7 | **Reservation Creation** | **`postReservation`** | • `propertyID`, `startDate`, `endDate`<br>• `rooms[]`, `adults[]`, `children[]`, `rateID/roomRateID`, `promoCode?`<br>• Guest details<br>• `paymentMethod` (+ `cardToken` / `paymentAuthorizationCode` if paying by card) | – For multi-hotel, you must also send `sourceID` and `thirdPartyIdentifier` if integrating OTAs.<br>– If the hotel allows choosing a specific room, get the list first with **`getRooms`** (filtering by `roomTypeID` and dates) and pass the selection as an "unassigned" reservation. |
| 8 | **Confirmation** – Show code and email | Response from **`postReservation`** | — | Use `reservationID`, `status`, and the returned `dailyRates` for the success screen and confirmation email. |

### Integration Best Practices

1.  **Minimize API Calls**
    *   Cache `getAvailableRoomTypes` results for a few minutes to avoid re-fetching when only changing view options (pagination, sorting, etc.).
    *   Call `getRate`/`getRatePlans` **only** when the customer interacts (changes occupancy, selects a promo, etc.).

2.  **Final Availability Check**
    Before executing `postReservation`, make one last call to `getRate` with the final parameters to ensure inventory is still available (`roomsAvailable > 0`) and the price hasn't changed.

3.  **Parallelize Requests**
    You can fire requests to `getRoomsFeesAndTaxes` and payment methods in parallel while the user is filling out personal details, so the payment page has all the information ready.

4.  **Error Handling**
    Every endpoint returns `success=false` + `message`. Map these messages to clear user alerts (e.g., "The promotional rate just sold out, please choose another option").

5.  **Security and PCI Compliance**
    *   Do not handle card data directly; use a `cardToken` generated by your payment gateway or Cloudbeds Payments.
    *   All calls must be signed with the hotel's OAuth 2.0 Bearer token.

6.  **Internationalization**
    Use `currencyCode`, `currencySymbol`, and `currencyPosition` to format prices. `getPaymentMethods` accepts `lang` to translate method names.

7.  **Analytics**
    Trace each call (request ID, latency, status) to debug and optimize response times.

---

## API Endpoint Reference

### `GET /api/v1.3/getRate`
> Returns the rate of the room type selected, based on the provided parameters.

#### Query Params
- `roomTypeID` (`string`, **required**): Room Type ID.
- `startDate` (`date`, **required**): Check-in date.
- `endDate` (`date`, **required**): Check-out date.
- `adults` (`integer`): Number of adults.
- `children` (`integer`): Number of children.
- `detailedRates` (`boolean`, default: `false`): If the rates need detailed information.
- `promoCode` (`boolean`, default: `false`): **DEPRECATED**. Return information for one or more specific rate plans by promo code. Use `getRatePlans` instead.

#### Response Body
- `success` (`boolean`): Returns if the request could be completed.
- `data` (`object`): Rates details.
    - `rateID` (`string`): Rate ID.
    - `isDerived` (`boolean`): This rate has been derived from another rate.
    - `roomRate` (`number`): Base rate for the room.
    - `totalRate` (`number`): Total rate for the room, including additional guest charges.
    - `roomsAvailable` (`integer`): Number of rooms available.
    - `daysOfWeek` (`array of strings | null`): ...
    - `roomRateDetailed` (`array of objects | null`): Detailed information on the rates, if requested.
        - `date` (`date`): Date for the rate.
        - `rate` (`number`): Base rate for the selected date.
        - `totalRate` (`number`): Total rate for the selected date.
        - `roomsAvailable` (`integer`): Number of rooms available for the selected date.
        - `closedToArrival` (`boolean`): ...
        - `closedToDeparture` (`boolean`): ...
        - `minLos` (`integer`): Minimum Length Of Stay.
        - `maxLos` (`integer`): Maximum Length Of Stay.

---

### `GET /api/v1.3/getAvailableRoomTypes`
> Returns a list of room types with availability considering the informed parameters. Supports group accounts.

#### Query Params
- `propertyIDs` (`string`): Property ID list, comma-separated (e.g., `37,345,89`).
- `startDate` (`date`, **required**): Check-In date.
- `endDate` (`date`, **required**): Check-Out date.
- `rooms` (`integer`, **required**, default: `1`): Number of rooms.
- `adults` (`integer`, **required**, default: `1`): Number of adults.
- `children` (`integer`, **required**): Number of children.
- `promoCode` (`string`): Promotional code.
- `detailedRates` (`boolean`, default: `false`): If detailed rates are expected.
- `sort` (`string`): Sort parameter.
- `order` (`string`, default: `asc`): Sort order.
- `minRate` (`number`): Minimum daily rate.
- `maxRate` (`number`): Maximum daily rate.
- `pageNumber` (`integer`, default: `1`): Page number.
- `pageSize` (`integer`, default: `20`): Page size.

#### Response Body
- `success` (`boolean`): Returns if the request could be completed.
- `data` (`array of objects`): Room Types details.
- `roomCount` (`integer`): Number of results (room types) returned.
- `count` (`integer`): Number of results (properties) returned.
- `total` (`integer`): Total number of results (properties).
- `message` (`string | null`): Error message if `success` is `false`.

---

### `GET /api/v1.3/getRooms`
> Returns a list of all rooms considering the informed parameters. If Check-in/out dates are sent, only unassigned rooms are returned. Supports group accounts.

#### Query Params
- `propertyIDs` (`string`): Property ID list, comma-separated.
- `roomTypeID` (`string`): Room type ID, comma-separated.
- `roomTypeNameShort` (`string`): Room Type (short-version).
- `startDate` (`date`): Initial stay date.
- `endDate` (`date`): Final stay date.
- `includeRoomRelations` (`integer`, default: `0`): Determines whether room relations info should be included.
- `pageNumber` (`integer`, default: `1`): Page number.
- `pageSize` (`integer`, default: `20`): Page size.

#### Response Body
- `success` (`boolean`): Returns if the request could be completed.
- `data` (`array of objects`): Room Types details.
- `count` (`integer`): Number of results (properties) returned.
- `total` (`integer`): Total number of results.
- `message` (`string | null`): Error message if `success` is `false`.

---

### `GET /api/v1.3/getRoomsFeesAndTaxes`
> Get applicable fees and tax to a booking. This is meant to be used on checkout to display to the guest.

#### Query Params
- `propertyID` (`string`): Property ID.
- `startDate` (`date`, **required**): Check-in date.
- `endDate` (`date`, **required**): Check-out date.
- `roomsTotal` (`number`, **required**): Total value of the rooms to be booked, with included taxes.
- `roomsCount` (`integer`, **required**): Number of rooms to be booked.

#### Response Body
- `success` (`boolean`): Returns if the request could be completed.
- `data` (`object`): Details of the fees and taxes.
    - `fees` (`array of objects`): Details of the fees.
    - `totalFees` (`number`): Total value of the fees.
    - `taxes` (`array of objects`): Details of the taxes.
    - `totalTaxes` (`number`): Total value of the taxes.
    - `roomsTotalWithoutTaxes` (`number`): `roomsTotal` parameter subtracting the included taxes.
    - `grandTotal` (`number`): Total with fees and taxes.
- `message` (`string | null`): Error message if `success` is `false`.

---

### `POST /api/v1.3/postReservation`
> Adds a reservation to the selected property.

#### Form Data
- `propertyID` (`string | null`): Property ID.
- `sourceID` (`string | null`): The third-party source ID for this reservation.
- `thirdPartyIdentifier` (`string | null`): Identifier from a booking channel.
- `startDate` (`date`): Check-In date.
- `endDate` (`date`): Check-Out date.
- `guestFirstName` (`string`): First name of the guest.
- `guestLastName` (`string`): Last name of the guest.
- `guestCountry` (`string`): Valid ISO-Code for Country (2 characters).
- `guestEmail` (`string`): Guest email.
- `rooms` (`array of objects`): Array with quantity of rooms.
- `adults` (`array of objects`): Array with number of adults.
- `children` (`array of objects`): Array with number of children.
- `paymentMethod` (`string`): Payment Method of choice.
- `cardToken` (`string | null`): Credit Card identifier (e.g., Stripe Customer ID).
- `paymentAuthorizationCode` (`string | null`): Transaction identifier (e.g., Stripe Charge ID).
- `sendEmailConfirmation` (`boolean | null`, default: `true`): Send confirmation email to guest.
- ... and other optional fields.

#### Response Body
- `success` (`boolean`): Returns if the request could be completed.
- `reservationID` (`string`): Reservation identifier.
- `status` (`string`): Reservation status (`not_confirmed`, `confirmed`).
- `guestID` (`string`): Guest ID.
- `...`

---

### `GET /api/v1.3/getRatePlans`
> Returns the rates of the room type or promo code selected. If no parameters are provided, it returns all publicly available rate plans. Supports group accounts.

#### Query Params
- `propertyIDs` (`string`): List of property IDs.
- `rateIDs` (`string`): List of Rate IDs.
- `roomTypeID` (`string`): List of Room Type IDs.
- `promoCode` (`string`): List of Promo Codes.
- `startDate` (`date`, **required**): Check-in date.
- `endDate` (`date`, **required**): Check-out date.
- `adults` (`integer`): Number of adults.
- `children` (`integer`): Number of children.
- `detailedRates` (`boolean`, default: `false`): If the rates need detailed information.

#### Response Body
- `success` (`boolean`): Returns if the request could be completed.
- `data` (`array of objects`): Rates details.
- `message` (`string | null`): Error message if `success` is `false`.

---

### `GET /api/v1.3/getPaymentMethods`
> Get a list of active payment methods for a property or list of properties.

#### Query Params
- `propertyID` (`string`): ID for the property to be queried.
- `lang` (`string`, default: `en`): Language for payment method names.

#### Response Body
- `success` (`boolean`): Returns if the request could be completed.
- `data` (`object`):
    - `propertyID` (`string`): Property ID.
    - `methods` (`array of objects`): List of active methods.
    - `gateway` (`array of objects`): Payment Gateway used by property.

---

### `GET /api/v1.3/getPaymentsCapabilities`
> Lists the payment capabilities of a given property.

#### Query Params
- `propertyID` (`string`): ID for the property to be queried.

#### Response Body
- `success` (`boolean`): Returns if the request could be completed.
- `data` (`array of objects`):
    - `cloudbedsPayments` (`boolean`): If Cloudbeds Payments is enabled.
    - `terminal` (`boolean`): If the property has an active terminal.
    - `tapToPay` (`boolean`): If tap-to-pay is enabled.
    - `gateway` (`string`): The backend gateway in use.
    - `payByLink` (`boolean`): If Pay-by-Link is enabled.
